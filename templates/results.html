<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SCAN RESULTS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(120deg, #A8FF96, #32CD32);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #0D1B0E;
        }
        h2, h4 {
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            color: #0B3D0B;
            text-shadow: 1px 1px 2px #fff;
        }
        .chart-section {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        table {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }
        th, td {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>SCAN RESULTS</h2>
    <p class="text-center">Session ID: {{ session_id }}</p>
    <p class="text-center">
        Total Files: {{ results|length }} |
        Benign: {{ results|selectattr('prediction','equalto',1)|list|length }} |
        Malicious: {{ results|selectattr('prediction','equalto',0)|list|length }}
    </p>

    <!-- Pie Chart -->
    <div class="chart-section">
        <h4>Benign vs Malicious</h4>
        <canvas id="pieChart"></canvas>
    </div>

    <!-- Bar Chart -->
    <div class="chart-section">
        <h4>File Classification (1=Benign, 0=Malicious)</h4>
        <canvas id="barChart"></canvas>
    </div>

    <!-- Line Chart -->
    <div class="chart-section">
        <h4>Probability Trend (%)</h4>
        <canvas id="lineChart"></canvas>
    </div>

    <!-- Results Table -->
    <div class="table-responsive">
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Prediction</th>
                    <th>Probability (%)</th>
                </tr>
            </thead>
            <tbody>
            {% for r in results %}
                <tr>
                    <td>{{ r.filename }}</td>
                    <td>{{ "Benign" if r.prediction==1 else "Malicious" }}</td>
                    <td>{{ r.probability }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
const results = {{ results|tojson }};

// Pie Chart
const benignCount = results.filter(r => r.prediction==1).length;
const maliciousCount = results.filter(r => r.prediction==0).length;
new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: {
        labels: [`Benign: ${benignCount}`, `Malicious: ${maliciousCount}`],
        datasets: [{ data: [benignCount, maliciousCount], backgroundColor: ['#0E4700','#177500'] }]
    }
});

// Bar Chart
new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: {
        labels: results.map(r=>r.filename),
        datasets: [{
            label: 'Classification',
            data: results.map(r=>r.prediction),
            backgroundColor: results.map(r=> r.prediction==1 ? '#177500' : '#0E4700')
        }]
    },
    options: { scales: { y: { beginAtZero:true, max:1, ticks: { stepSize: 1 } } } }
});

// Line Chart
new Chart(document.getElementById('lineChart'), {
    type: 'line',
    data: {
        labels: results.map(r=>r.filename),
        datasets: [{
            label: 'Probability (%)',
            data: results.map(r=>r.probability),
            borderColor: '#0E4700',
            backgroundColor: '#177500',
            fill: false,
            tension: 0.2
        }]
    },
    options: { scales: { y: { beginAtZero:true, max:100 } } }
});
</script>
</body>
</html>

